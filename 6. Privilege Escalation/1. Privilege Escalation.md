
## PrivEsc Checklists

- One excellent resource is [HackTricks](https://book.hacktricks.xyz/), which has an excellent checklist for both [Linux](https://book.hacktricks.wiki/en/linux-hardening/linux-privilege-escalation-checklist.html) and [Windows](https://book.hacktricks.wiki/en/windows-hardening/checklist-windows-privilege-escalation.html) local privilege escalation.
- Another excellent repository is [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings), which also has checklists for both [Linux](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md) and [Windows](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md).


## Enumeration Scripts

- Linux enumeration scripts include [LinEnum](https://github.com/rebootuser/LinEnum.git) and [linuxprivchecker](https://github.com/sleventyeleven/linuxprivchecker), and for Windows include [Seatbelt](https://github.com/GhostPack/Seatbelt) and [JAWS](https://github.com/411Hall/JAWS).
- Another useful tool we may use for server enumeration is the [Privilege Escalation Awesome Scripts SUITE (PEASS)](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite)

## Kernel Exploits

- Look for kernel exploits whenever we encounter an old operating system.
- Google for exploits for that specific os version.

## Vulnerable Software

- Look for vulnerable software in the installed software.
- `dpkg -l ` command on Linux to see installed software
- `C:\Program Files` on windows contain all the installed software for windows.

## User Privileges

- Suppose we are able to run specific commands as root, we may be able to escalate our privileges to root/system.
- Common ways to exploit user privileges : 
		1. Sudo
		2. SUID
		3. Windows Token Privileges
- We can check sudo privileges we have with the `sudo -l `command.
**Eg**
![[Pasted image 20251216085004.png]]

- In certain scenario's when we run the `sudo -l` command, we will be able to see certain commands that a user is able to run as root with "`NOPASSWD`".
- We can run those commands without a password.
- In that scenario we can use the `sudo -u user /bin/echo Hello World!`.

- Once we find a particular application that we can run with sudo, we can look for ways to exploit it to get a shell as the root user.
-  [GTFOBins](https://gtfobins.github.io/) contains a list of commands and how they can be exploited through `sudo`. We can search for the application we have `sudo` privilege over, and if it exists, it may tell us the exact command we should execute to gain root access using the `sudo` privilege we have.
- [LOLBAS](https://lolbas-project.github.io/#) also contains a list of Windows applications which we may be able to leverage to perform certain functions, like downloading files or executing commands in the context of a privileged user.


# Scheduled Tasks

- Scheduled tasks (Windows)
- cron jobs (Linux)
- There are basically 2 ways we can take advantage of these : 
		1. Add new schedule tasks/ cron jobs.
		2. Trick them to execute a malicious software.
		
- `Checking if we are allowed to add new scheduled tasks : `
		1. In Linux, check if we have write permissions over these directories : 
			1. `/etc/crontab`
			2. `/etc/cron.d`
			3. `/var/spool/cron/crontabs/root`

# Exposed Credentials

- Look for files (`config files, log files and user history files`) we can reed and see if then contain any exposed credentials.
- The [[#Enumeration Scripts]] usually look for these kinds of passwords will provide them to us.
- If passwords found : 
		1. Check password reuse : `su -`, then enter the password to see if we can get system access.
		2. Try SSHing into their server as that user.
		   
# SSH Keys

1. If we have read access over the .ssh directory for a specific user, we may read  private ssh keys found in `/home/user/.ssh/id_rsa` or `/root/.ssh/id_rsa`, and use it to log in to the server. If we can read the `/root/.ssh/` directory and can read the `id_rsa` file, we can copy it to our machine and use the `-i` flag to log in with it:
**Eg:** 
![[Pasted image 20251216093516.png]]
- `chmod 600 `command was used to change the file's permissions to be more restrictive. If ssh keys have lax permissions (maybe read by other people), ssh server would prevent them from working.
1. If we have write access to a users`/.ssh/` directory, we can place our public key in the user's ssh directory at `/home/user/.ssh/authorized_keys`. This technique is usually used to gain ssh access after gaining a shell as that user. The current SSH configuration will not accept keys written by other users, so it will only work if we have already gained control over that user. We must first create a new key with `ssh-keygen` and the `-f` flag to specify the output file:

```shell-session
ssh-keygen -f key
```
- This gives two files, `Key` (which we will use with ssh -i) and key.pub (which we will copy to the remote machine (/root/.ssh/authorized_keys))
```shell-session
user@remotehost$ echo "ssh-rsa AAAAB...SNIP...M= user@parrot" >> /root/.ssh/authorized_keys
```
- Then login as that users by using our private key

```shell-session
ssh root@<ip-addresss> -p <port> -i key
```
