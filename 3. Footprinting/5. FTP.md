# FTP

File Transfer Protocol - runs within the application layer of TCP/IP protocol stack.

---

## How FTP Works

In an FTP connection, two channels are opened:

1. Client and server establish control channel through `TCP port 21`
2. The client sends commands to the server, and the server returns status codes
3. Then both parties can establish data channel via `TCP port 20` (this channel is used exclusively for data transmission)

## Active vs Passive FTP

| Mode | Description |
|------|-------------|
| **Active FTP** | Client establishes the connection via port 21. However, if there's a firewall, server cannot reply because all external connections are blocked |
| **Passive FTP** | Server announces a port through which the client can establish the data channel. Since the client is initiating the connection, the firewall doesn't block the transfer |

## TFTP

Trivial File Transfer Protocol - simpler than FTP:

- Does not provide user authentication and other features supported by FTP
- FTP uses TCP, TFTP uses UDP

| Command | Description |
|---------|-------------|
| `connect` | Sets the remote host, and optionally the port, for file transfers |
| `get` | Transfers a file or set of files from the remote host to the local host |
| `put` | Transfers a file or set of files from the local host onto the remote host |
| `quit` | Exits tftp |
| `status` | Shows the current status of tftp, including the current transfer mode (ascii or binary), connection status, time-out value, and so on |
| `verbose` | Turns verbose mode, which displays additional information during file transfer, on or off |

## Default Configuration

One of the most common FTP servers is `vsFTPd`.

## Anonymous Login

Allows logging into FTP servers without requiring credentials.

### Download All Available Files

```bash
wget -m --no-passive ftp://anonymous:anonymous@10.129.14.136
```

### Upload a File

```bash
touch xyz.txt
put xyz.txt
```

## Service Interaction

```bash
nc -nv 10.129.14.136 21
```

```bash
telnet 10.129.14.136 21
```

```bash
openssl s_client -connect 10.129.14.136:21 -starttls ftp
```

---

See also: [[6. SMB]], [[7. NFS]]
