# Host Discovery

When we need to conduct an internal pentest for the entire network of a company, we should first `get an overview of which systems are online that we can work with.`

There are multiple host discovery options in Nmap, but the `most effective method is to use ICMP echo requests`.

---

## Scan Network Range

```bash
sudo nmap 10.129.2.0/24 -sn -oA tnet | grep for | cut -d" " -f5
```

| Flag | Description |
|------|-------------|
| `-sn` | Disables port scanning |
| `-oA` | Stores the results in all formats starting with the name tnet |

## Scan IP List

During an internal pentest, it is not uncommon for us to be provided with an IP list with the hosts we need to test.

```bash
sudo nmap -sn -oA tnet -iL hosts.lst | grep for | cut -d" " -f5
```

| Flag | Description |
|------|-------------|
| `-iL` | Performs defined scans against targets in provided 'hosts.lst' list |

## Scan Multiple IPs

```bash
sudo nmap -sn -oA tnet 10.129.2.18 10.129.2.19 10.129.2.20 | grep for | cut -d" " -f5
```

Since we are using `-sn` (disable port scan), Nmap automatically ping scan with ICMP Echo Requests (-PE).

The more interesting fact is that our previous scans did not do that because before Nmap could send an ICMP echo request, it would send an `ARP ping` resulting in an `ARP reply`. We can confirm this with the "`--packet-trace`" option. To ensure that ICMP echo requests are sent, we also define the option (`-PE`) for this.

## Common Default TTL Values

| Operating System | TTL Value |
|-----------------|-----------|
| Linux / Unix | 64 |
| Windows | 128 |
| Network devices (Cisco, etc.) | 255 |

---

See also: [[1. Enumeration]], [[3. Host and Port Scanning]]
