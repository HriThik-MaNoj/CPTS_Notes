Server Message Block
- Regulates access to files and entire directories and other network resources such as printers, routers, or interfaces released for the network.
- Particularly used in windows
- In IP networks, SMB uses TCP protocol to establish a connection.

### Samba
- Alternative implementation of SMB server.
- `TCP 445`
- for unix-based operating systems.
- `Workgroup `: group name that identifies an arbitrary collection of computers and their resources on an SMB network.
- There can be multiple workgroups on the network at any given time.

#### SMBclient - Connecting to the Share
```shell-session
smbclient -N -L //10.129.14.128
```

#### Download Files from SMB

```shell-session
smb: \> get prep-prod.txt 
```

## Footprinting SMB

```
sudo nmap <ip-address> -sV -sC -p139,445
```
 - In certain scenario's nmap scan doesn't provide much info, so we need to interact with the SMB and send specific requests for the information.
 - one tool used is `rpcclient`
##### RPCclient

```
rpcclient -U "" <ip-address>
```

| **Query**                 | **Description**                                                    |
| ------------------------- | ------------------------------------------------------------------ |
| `srvinfo`                 | Server information.                                                |
| `enumdomains`             | Enumerate all domains that are deployed in the network.            |
| `querydominfo`            | Provides domain, server, and user information of deployed domains. |
| `netshareenumall`         | Enumerates all available shares.                                   |
| `netsharegetinfo <share>` | Provides information about a specific share.                       |
| `enumdomusers`            | Enumerates all domain users.                                       |
| `queryuser <RID>`         | Provides information about a specific user.                        |

#### Brute forcing user RID's
```shell-session
for i in $(seq 500 1100);do rpcclient -N -U "" 10.129.14.128 -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";done
```
