# IMAP & POP3

> [!NOTE]
> **TODO:** This note is incomplete and needs to be expanded with more content.

---

## Overview

- **IMAP** (Internet Message Access Protocol) - allows accessing and managing emails directly on the mail server
- **POP3** (Post Office Protocol) - downloads emails from the server to the local client

![[attachments/Pasted image 20251222090927.png]]

## Default Ports

| Protocol | Port |
|----------|------|
| IMAP | 143 |
| IMAPS (SSL) | 993 |
| POP3 | 110 |
| POP3S (SSL) | 995 |

## IMAP Commands

|**Command**|**Description**|
|---|---|
|`1 LOGIN username password`|User's login.|
|`1 LIST "" *`|Lists all directories.|
|`1 CREATE "INBOX"`|Creates a mailbox with a specified name.|
|`1 DELETE "INBOX"`|Deletes a mailbox.|
|`1 RENAME "ToRead" "Important"`|Renames a mailbox.|
|`1 LSUB "" *`|Returns a subset of names from the set of names that the User has declared as being `active` or `subscribed`.|
|`1 SELECT INBOX`|Selects a mailbox so that messages in the mailbox can be accessed.|
|`1 UNSELECT INBOX`|Exits the selected mailbox.|
|`1 FETCH <ID> all`|Retrieves data associated with a message in the mailbox.|
|`1 CLOSE`|Removes all messages with the `Deleted` flag set.|
|`1 LOGOUT`|Closes the connection with the IMAP server.|

## POP3 Commands

| **Command**     | **Description**                                             |
| --------------- | ----------------------------------------------------------- |
| `USER username` | Identifies the user.                                        |
| `PASS password` | Authentication of the user using its password.              |
| `STAT`          | Requests the number of saved emails from the server.        |
| `LIST`          | Requests from the server the number and size of all emails. |
| `RETR id`       | Requests the server to deliver the requested email by ID.   |
| `DELE id`       | Requests the server to delete the requested email by ID.    |
| `CAPA`          | Requests the server to display the server capabilities.     |
| `RSET`          | Requests the server to reset the transmitted information.   |
| `QUIT`          | Closes the connection with the POP3 server.                 |

## Footprinting the service

| Port       | **Description** |
| ---------- | --------------- |
| `110, 995` | POP3            |
| `143, 993` | IMAP            |
 - 993 and 995 use TLS/ SSL to encrypt the client server communication.
- If we successfully figure out the access credentials for one of the employees, an attacker could log in to the mail server and read or even send the individual messages.

```bash
curl -k 'imaps://<ip-address>' --user user:password
```
---

See also: [[8. DNS]], [[9. SMTP]]