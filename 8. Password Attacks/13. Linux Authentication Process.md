- One of the most commonly used authentication mechanism in linux based distributions is [Pluggable Authentication Modules (PAM)](https://web.archive.org/web/20220622215926/http://www.linux-pam.org/Linux-PAM-html/Linux-PAM_SAG.html).
- The modules responsible for this functionality, such as `pam_unix.so` or `pam_unix2.so`, are typically located in `/usr/lib/x86_64-linux-gnu/security/` on Debian-based systems.
- These modules manage user information, authentication, sessions, and password changes.
- For example, when a user changes their password using the `passwd` command, PAM is invoked, which takes the appropriate precautions to handle and store the information accordingly.

## Passwd file

- Contains information about all the users
- Readable by all users and services.
- Each entry corresponding to a single user consists of seven fields.

|**Field**|**Value**|
|---|---|
|**Username**|`htb-student`|
|**Password**|`x`|
|**User ID**|`1000`|
|**Group ID**|`1000`|
|**[GECOS](https://en.wikipedia.org/wiki/Gecos_field)**|`,,,`|
|**Home directory**|`/home/htb-student`|
|**Default shell**|`/bin/bash`|
- Usually, we will find the value `x` in the password  field, indicating that the passwords are stored in a hashed form within the `/etc/shadow` file. However, it can also be that the `/etc/passwd` file is writeable by mistake. This would allow us to remove the password field for the `root` user entirely.

```shell-session
#displays the first line of the user database, which is almost always the root user's configuration.

HrithikManoj000@htb[/htb]$ head -n 1 /etc/passwd
```

## Shadow file

- If there is no entry in the `/etc/shadow` file for a user listed in `/etc/passwd`, that user is considered invalid.
- The format of this file is divided into the following `nine fields`:

| Field             | Value                              |
| ----------------- | ---------------------------------- |
| Username          | `htb-student`                      |
| Password          | `$y$j9T$3QSBB6CbHEu...SNIP...f8Ms` |
| Last change       | `18955`                            |
| Min age           | `0`                                |
| Max age           | `99999`                            |
| Warning period    | `7`                                |
| Inactivity period | `-`                                |
| Expiration date   | `-`                                |
| Reserved field    | `-`                                |

- If the `Password` field contains a character such as `!` or `*`, the user cannot log in using a Unix password. However, other authentication methods—such as Kerberos or key-based authentication—can still be used.

The `Password` field also follows a particular format, from which we can extract additional information:

- `$<id>$<salt>$<hashed>`

As we can see here, the hashed passwords are divided into three parts. The `ID` value specifies which cryptographic hash algorithm was used, typically one of the following:

|ID|Cryptographic Hash Algorithm|
|---|---|
|`1`|[MD5](https://en.wikipedia.org/wiki/MD5)|
|`2a`|[Blowfish](https://en.wikipedia.org/wiki/Blowfish_\(cipher\))|
|`5`|[SHA-256](https://en.wikipedia.org/wiki/SHA-2)|
|`6`|[SHA-512](https://en.wikipedia.org/wiki/SHA-2)|
|`sha1`|[SHA1crypt](https://en.wikipedia.org/wiki/SHA-1)|
|`y`|[Yescrypt](https://github.com/openwall/yescrypt)|
|`gy`|[Gost-yescrypt](https://www.openwall.com/lists/yescrypt/2019/06/30/1)|
|`7`|[Scrypt](https://en.wikipedia.org/wiki/Scrypt)|

Many Linux distributions, including Debian, now use `yescrypt` as the default hashing algorithm. On older systems, however, we may still encounter other hashing methods that can potentially be cracked.

## Opasswd
- The PAM library (`pam_unix.so`) can prevent users from reusing old passwords. These previous passwords are stored in the `/etc/security/opasswd` file.
- Admin privilages required to read this file.
- contains previous passwds of the users.
- Can see they are using a password hashing method like MD5 which is significantly easier to crack than sha-512

## Cracking Linux Credentials
