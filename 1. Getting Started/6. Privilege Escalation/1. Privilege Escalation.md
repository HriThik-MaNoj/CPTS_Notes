# Privilege Escalation

Techniques for escalating privileges after initial access to a target system.

---

## PrivEsc Checklists

- [HackTricks](https://book.hacktricks.xyz/) has excellent checklists for both [Linux](https://book.hacktricks.wiki/en/linux-hardening/linux-privilege-escalation-checklist.html) and [Windows](https://book.hacktricks.wiki/en/windows-hardening/checklist-windows-privilege-escalation.html) local privilege escalation
- [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings) also has checklists for both [Linux](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md) and [Windows](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md)

## Enumeration Scripts

| Platform | Tools |
|----------|-------|
| Linux | [LinEnum](https://github.com/rebootuser/LinEnum.git), [linuxprivchecker](https://github.com/sleventyeleven/linuxprivchecker) |
| Windows | [Seatbelt](https://github.com/GhostPack/Seatbelt), [JAWS](https://github.com/411Hall/JAWS) |
| Both | [PEASS](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite) |

## Kernel Exploits

- Look for kernel exploits whenever we encounter an old operating system
- Google for exploits for that specific OS version

## Vulnerable Software

- Look for vulnerable software in the installed software
- `dpkg -l` command on Linux to see installed software
- `C:\Program Files` on Windows contains all the installed software

## User Privileges

If we are able to run specific commands as root, we may be able to escalate our privileges to root/system.

Common ways to exploit user privileges:
1. Sudo
2. SUID
3. Windows Token Privileges

### Checking Sudo Privileges

We can check sudo privileges with the `sudo -l` command:

![[attachments/Pasted image 20251216085004.png]]

When we run `sudo -l`, we may see certain commands that a user is able to run as root with "`NOPASSWD`". We can run those commands without a password using:

```bash
sudo -u user /bin/echo Hello World!
```

### Exploiting Sudo Privileges

Once we find a particular application that we can run with sudo, we can look for ways to exploit it to get a shell as the root user:

- [GTFOBins](https://gtfobins.github.io/) contains a list of commands and how they can be exploited through `sudo`
- [LOLBAS](https://lolbas-project.github.io/#) contains a list of Windows applications which we may be able to leverage

## Scheduled Tasks

- Scheduled tasks (Windows)
- Cron jobs (Linux)

There are basically 2 ways we can take advantage of these:
1. Add new scheduled tasks/cron jobs
2. Trick them to execute malicious software

### Checking for Cron Job Permissions (Linux)

Check if we have write permissions over these directories:
- `/etc/crontab`
- `/etc/cron.d`
- `/var/spool/cron/crontabs/root`

## Exposed Credentials

- Look for files (`config files, log files and user history files`) we can read and see if they contain any exposed credentials
- The [Enumeration Scripts](#enumeration-scripts) usually look for these kinds of passwords

If passwords found:
1. Check password reuse: `su -`, then enter the password to see if we can get system access
2. Try SSHing into their server as that user

## SSH Keys

### Reading Private Keys

If we have read access over the `.ssh` directory for a specific user, we may read private ssh keys found in `/home/user/.ssh/id_rsa` or `/root/.ssh/id_rsa`, and use it to log in to the server:

![[attachments/Pasted image 20251216093516.png]]

> **Note:** `chmod 600` command was used to change the file's permissions to be more restrictive. If ssh keys have lax permissions, the ssh server would prevent them from working.

### Writing Public Keys

If we have write access to a user's `/.ssh/` directory, we can place our public key in the user's ssh directory at `/home/user/.ssh/authorized_keys`.

First, create a new key with `ssh-keygen`:

```bash
ssh-keygen -f key
```

This gives two files: `key` (which we will use with ssh -i) and `key.pub` (which we will copy to the remote machine).

```bash
echo "ssh-rsa AAAAB...SNIP...M= user@parrot" >> /root/.ssh/authorized_keys
```

Then login using our private key:

```bash
ssh root@<ip-address> -p <port> -i key
```

---

See also: [[1. Shell types]], [[2. Upgrading TTY]]