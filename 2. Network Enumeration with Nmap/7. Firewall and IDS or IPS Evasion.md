
## Decoys

- Administrators may block specific subnets from different regions in principle, This prevents any access to the target network.
- Using the Decoy (`-D`) scanning method, we can generage random (`RND`) a specific number (for example 5) of IP addresses separated by a colon (:). 
- Our real IP address is then randomly placed between the generated IP addresses.
- Critical point : Our decoys must be alive, otherwise our target may be unreachable due to SYN-flooding security mechanisms.
**Scan by using Decoys :** 
```shell-session
sudo nmap 10.129.2.28 -p 80 -sS -Pn -n --disable-arp-ping --packet-trace -D RND:5
```
|**Scanning Options**|**Description**|
|---|---|
|`10.129.2.28`|Scans the specified target.|
|`-p 80`|Scans only the specified ports.|
|`-sS`|Performs SYN scan on specified ports.|
|`-Pn`|Disables ICMP Echo requests.|
|`-n`|Disables DNS resolution.|
|`--disable-arp-ping`|Disables ARP ping.|
|`--packet-trace`|Shows all packets sent and received.|
|`-D RND:5`|Generates five random IP addresses that indicates the source IP the connection comes from.|

## Scan by Using Different Source IP

```shell-session
sudo nmap 10.129.2.28 -n -Pn -p 445 -O -S 10.129.2.200 -e tun0
```

| **Scanning Options** | **Description**                                        |
| -------------------- | ------------------------------------------------------ |
| `10.129.2.28`        | Scans the specified target.                            |
| `-n`                 | Disables DNS resolution.                               |
| `-Pn`                | Disables ICMP Echo requests.                           |
| `-p 445`             | Scans only the specified ports.                        |
| `-O`                 | Performs operation system detection scan.              |
| `-S`                 | Scans the target by using different source IP address. |
| `10.129.2.200`       | Specifies the source IP address.                       |
| `-e tun0`            | Sends all requests through the specified interface.    |

## DNS Proxying

#### 1. Reverse DNS Resolution

When you scan an IP address (like `192.168.1.1`), Nmap automatically asks a DNS server: _"What is the hostname associated with this IP?"_

- **Why?** Finding a name like `dev-server.company.com` tells you much more about the target’s purpose than just an IP.
    
- **The "Pass" Rule:** Firewalls usually let these queries through because servers _want_ to be found so people can visit their websites.

#### 2. UDP vs. TCP Port 53

DNS traditionally uses two "doors" (ports) to send data:

- **UDP Port 53:** Used for standard, small requests (like looking up a website). It’s fast but has a size limit.
    
- **TCP Port 53:** Traditionally used for **Zone Transfers** (sending a complete list of every domain a company owns) or very large files.
    
- **The Change:** Because of modern security (DNSSEC) and longer addresses (IPv6), DNS data is getting bigger. Therefore, TCP port 53 is being used much more frequently than it used to be.
    
#### 3. The "DMZ" and Trusted DNS

A **DMZ (Demilitarized Zone)** is a subnetwork that sits between the public internet and a private internal network.

- **The Strategy:** If you are inside a company's network, the internal DNS servers "trust" each other more than they trust Google or Cloudflare.
    
- **The Attack:** By telling Nmap to use the company’s internal DNS server (`--dns-server`), you might be able to find "hidden" internal hostnames that aren't visible to the outside world.
    
#### 4. Bypassing Firewalls (The Source Port Trick)

This is the most "hacky" part of the text. It describes a trick to get past a Firewall or IDS (Intrusion Detection System).

|**Component**|**Logic**|
|---|---|
|**The Firewall Rule**|An admin might create a rule: _"Any traffic coming FROM port 53 is probably just a DNS server responding, so let it in."_|
|**The Exploit**|You tell Nmap to pretend your scan is coming from port 53 (`--source-port 53`).|
|**The Result**|The firewall sees the packet, thinks "Oh, this is just a DNS response," and lets your scan reach the target undetected.|
