#nmap #html #xml #stylesheet #scantypes #enumeration #tcp #udp 
`Enumeration is the key`

# Nmap
- Written  in C, C++, Python and Lua
- Nmap can be divided into the following scanning techniques:

1. Host discovery
2. Port scanning
3. Service enumeration and detection
4. OS detection
5. Scriptable interaction with the target service (Nmap Scripting Engine)
##### Syntax
```shell-session
nmap <scan types> <options> <target>
```

#### TCP-SYN Scan (-sS)

- Default setting unless we define otherwise.
- Can scan thousands of ports per second.
- `Sends one packet with the SYN flag`, therefore, never completes the `three-way handshake`, which results in not establishing a full TCP connection to the scanned port.
- If our target sends a `SYN-ACK` flagged packet back to us, Nmap detects that the port is `open`.
- If the target responds with an `RST` flagged packet, it is an indicator that the port is `closed`.
- If Nmap does not receive a packet back, it will display it as `filtered`. Depending on the firewall configuration, certain packets may be dropped or ignored by the firewall.
#### TCP Connect Scan (-sT)

- Highly Accurate but not stealthy
- Uses the three-way handshake to determine if a specific port on a target host is open or closed.
- Sends an `SYN` packet to the target port and waits for a response. It is considered open if the target port responds with an `SYN-ACK` packet and closed if it responds with an `RST` packet.

## Host Discovery

- When we need to conduct and internal pentest for the entire network of a company, for example, we should, first of all, `get an overview of which systems are online that we can work with.`
- There are multiple host discovery options in Nmap, but the `most effective method is to use ICMP echo requests`.

**Scan Network Range :** 
```shell-session
sudo nmap 10.129.2.0/24 -sn -oA tnet | grep for | cut -d" " -f5
```
- `-sn` : Disables port scanning.
- `-oA` : Stores the results in all formats starting with the name tnet.

## Scan IP List

- During an internal pentest, it is not uncommon for us to be provided with an IP list with the hosts we need to test.
```shell-session
sudo nmap -sn -oA tnet -iL hosts.lst | grep for | cut -d" " -f5
```
- `-iL` : Performs defined scans against targets in provided 'hosts.lst' list.

## Scan Multiple IPs

```shell-session
sudo nmap -sn -oA tnet 10.129.2.18 10.129.2.19 10.129.2.20| grep for | cut -d" " -f5
```

- since we are using `-sn` (disable port scan), Nmap automatically ping scan with ICMP Echo Requests (-PE).
- The more interesting fact is that our previous scans did not do that because before Nmap could send an ICMP echo request, it would send an `ARP ping` resulting in an `ARP reply`. We can confirm this with the "`--packet-trace`" option. To ensure that ICMP echo requests are sent, we also define the option (`-PE`) for this.
#### Common default TTL values

- **Linux / Unix** → 64
    
- **Windows** → 128
    
- **Network devices (Cisco, etc.)** → 255


## Host and Port Scanning

-  After we find out that our target is alive, we want to get a more accurate picture of the system.
- This includes : 
		1. Open ports
		2. Service Versions
		3. Information that the services provided.
		4. Operating System
#### Different states of scanned ports
1. open : connection to scanned port has been established.
2. closed : Received back packet contains an `RST `flag.
3. filtered  : nmap cannot correctly identify whether the scanned port is open or closed.Either no response received or error code from the target.
4. unfiltered : Only occurs during `TCP-ACK` scan. port is accessible but cannot determine whether it's open or closed.
5. open | filtered : no response for a specific port, firewall or packet filter may protect the port.
6. closed | filtered : Occurs only during `IP ID idle` scans, indicates that it was impossible to determine if the scanned port is closed or filtered.

## Discovering Open TCP ports

- By default Nmap scans the top 1000 ports using the `TCP-SYN` scan (-sS), **`Only when we run it with root`**
- Else TCP connect scan is performed (-sT)

##### Nmap flag to scan top ports

```shell-session
sudo nmap 10.129.2.28 --top-ports=10 
```

### UDP Port Scan

- UDP is a stateless protocol, does not require a three-way handshake like TCP.
- No ackowledgement, higher timeout

```shell-session
sudo nmap 10.129.2.28 -F -sU
```

### Saving the Results

`-oN `: normal output  with `.nmap `file extension
`-oG `: Grepable output with `.gnmap` file extension
`-oX `: XML output with .`xml` file extension

### Style Sheets

- With XML output, we can easily create HTML reports that are easy to read, even for non-technical people.
- To convert XML format to HTML, we can use the tool `xsltproc`.
```shell-session
xsltproc target.xml -o target.html
```
![[Pasted image 20251218081044.png]]
- **That's Dope!, how com I never knew this..**

## Service Enumeration

- It is recommended to perform a quick port scan first, which gives us a small overview of the available ports. This causes significantly less traffic (else we may be discovered and blocked by the security mechanisms).

###### Stats every x seconds
- defining how periods of time the status shouldbe shown
```shell-session
sudo nmap 10.129.2.28 -p- -sV --stats-every=5s
```
